<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ðŸ’¡ ReMind</title>
  <link rel="stylesheet" href="/index.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<header class="header">
  <img src="/logo2.png" alt="ReMind ë¡œê³ " class="logo" />

  <% if (currentUser) { %>
    <div class="user-menu">
      <span class="user-nickname"><%= currentUser.nickname %> ë‹˜</span>
      <i class="fa-solid fa-user icon" onclick="toggleDropdown()"></i>
      <div class="dropdown" id="userDropdown">
        <a href="/my-info">ë‚´ ì •ë³´ ìˆ˜ì •</a>
        <a href="/my-posts">ë‚´ê°€ ì“´ ê¸€ ë¦¬ìŠ¤íŠ¸</a>
        <a href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
      </div>
    </div>
  <% } %>
</header>

<body>

  <% if (currentUser) { %>
    <!-- í¬ìŠ¤íŠ¸ìž‡ ìž‘ì„± í¼ -->
    <form id="postForm" action="/add" method="POST">
      <textarea name="content" placeholder="í¬ìŠ¤íŠ¸ìž‡ ë‚´ìš©" required></textarea>
      <button type="submit">ì¶”ê°€</button>
    </form>
  <% } %>

  <div class="posts">
    <% posts.forEach((post, index) => { %>
      <div class="post-it">
        <%= post.content.replace(/\n/g, '<br>') %>
        <small>- <%= post.nickname %></small>

        <% if(currentUser && post.userId === currentUser.id) { %>
          <i class="fa-solid fa-ellipsis-vertical menu-btn" onclick="togglePostMenu('<%= index %>')"></i>
          <div class="post-menu" id="postMenu-<%= index %>">
            <a href="/edit/<%= index %>">ê¸€ ìˆ˜ì •</a>
            <a href="/delete/<%= index %>">ê¸€ ì‚­ì œ</a>
          </div>
        <% } %>
      </div>
    <% }) %>
  </div>

  <script>
    function toggleDropdown() {
      const el = document.getElementById('userDropdown');
      el.classList.toggle('open');
    }
    function togglePostMenu(i) {
      const el = document.getElementById('postMenu-' + i);
      el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }
  </script>
</body>
</html>
